<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chirag Sharma">
<meta name="dcterms.date" content="2024-01-06">
<meta name="description" content="In this post, we will solve an end-to-end an analytical case study using SQL.">

<title>Chirag Sharma - Solving Case Study #6 - Clique Bait using SQL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../favicon/icons8-darth-vader-512.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Chirag Sharma</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../portfolio.html" rel="" target="">
 <span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../resume/Resume.pdf" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Chirag1994" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://medium.com/@chirag.sharma0378" rel="" target=""><i class="bi bi-medium" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/chiragsharma1994/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Solving Case Study #6 - Clique Bait using SQL</h1>
                  <div>
        <div class="description">
          In this post, we will solve an end-to-end an analytical case study using SQL.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">SQL</div>
                <div class="quarto-category">MySQL</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Chirag Sharma </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 6, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#case-study-6---clique-bait" id="toc-case-study-6---clique-bait" class="nav-link active" data-scroll-target="#case-study-6---clique-bait">Case Study #6 - Clique Bait</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#available-data" id="toc-available-data" class="nav-link" data-scroll-target="#available-data">Available Data</a>
  <ul class="collapse">
  <li><a href="#users" id="toc-users" class="nav-link" data-scroll-target="#users">Users</a></li>
  <li><a href="#events" id="toc-events" class="nav-link" data-scroll-target="#events">Events</a></li>
  <li><a href="#event-identifier" id="toc-event-identifier" class="nav-link" data-scroll-target="#event-identifier">Event Identifier</a></li>
  <li><a href="#campaign-identifier" id="toc-campaign-identifier" class="nav-link" data-scroll-target="#campaign-identifier">Campaign Identifier</a></li>
  <li><a href="#page-hierarchy" id="toc-page-hierarchy" class="nav-link" data-scroll-target="#page-hierarchy">Page Hierarchy</a></li>
  </ul></li>
  <li><a href="#interactive-sql-instance" id="toc-interactive-sql-instance" class="nav-link" data-scroll-target="#interactive-sql-instance">Interactive SQL Instance</a></li>
  <li><a href="#case-study-questions" id="toc-case-study-questions" class="nav-link" data-scroll-target="#case-study-questions">Case Study Questions</a>
  <ul class="collapse">
  <li><a href="#enterprise-relationship-diagram" id="toc-enterprise-relationship-diagram" class="nav-link" data-scroll-target="#enterprise-relationship-diagram">1. Enterprise Relationship Diagram</a></li>
  <li><a href="#digital-analysis" id="toc-digital-analysis" class="nav-link" data-scroll-target="#digital-analysis">2. Digital Analysis</a></li>
  <li><a href="#product-funnel-analysis" id="toc-product-funnel-analysis" class="nav-link" data-scroll-target="#product-funnel-analysis">3. Product Funnel Analysis</a></li>
  <li><a href="#campaigns-analysis" id="toc-campaigns-analysis" class="nav-link" data-scroll-target="#campaigns-analysis">4. Campaigns Analysis</a></li>
  </ul></li>
  <li><a href="#lets-start-solving-them." id="toc-lets-start-solving-them." class="nav-link" data-scroll-target="#lets-start-solving-them.">Let’s start solving them.</a>
  <ul class="collapse">
  <li><a href="#digital-analysis-1" id="toc-digital-analysis-1" class="nav-link" data-scroll-target="#digital-analysis-1">2. Digital Analysis</a></li>
  <li><a href="#product-funnel-analysis-1" id="toc-product-funnel-analysis-1" class="nav-link" data-scroll-target="#product-funnel-analysis-1">3. Product Funnel Analysis</a></li>
  <li><a href="#campaigns-analysis-1" id="toc-campaigns-analysis-1" class="nav-link" data-scroll-target="#campaigns-analysis-1">4. Campaigns Analysis</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">




<section id="case-study-6---clique-bait" class="level1">
<h1>Case Study #6 - Clique Bait</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/3a81bec3-1-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">1.png</figcaption>
</figure>
</div>
<hr>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Clique Bait is not like your regular online seafood store - the founder and CEO Danny, was also a part of a digital data analytics team and wanted to expand his knowledge into the seafood industry!</p>
<p>In this case study - you are required to support Danny’s vision and analyse his dataset and come up with creative solutions to calculate funnel fallout rates for the Clique Bait online store.</p>
<hr>
</section>
<section id="available-data" class="level2">
<h2 class="anchored" data-anchor-id="available-data">Available Data</h2>
<p>For this case study there is a total of 5 datasets which you will need to combine to solve all of the questions.</p>
<section id="users" class="level3">
<h3 class="anchored" data-anchor-id="users">Users</h3>
<p>Customers who visit the Clique Bait website are tagged via their <code>cookie_id</code>.</p>
<table class="table">
<thead>
<tr class="header">
<th>user_id</th>
<th>cookie_id</th>
<th>start_date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>397</td>
<td>3759ff</td>
<td>2020-03-30 00:00:00</td>
</tr>
<tr class="even">
<td>215</td>
<td>863329</td>
<td>2020-01-26 00:00:00</td>
</tr>
<tr class="odd">
<td>191</td>
<td>eefca9</td>
<td>2020-03-15 00:00:00</td>
</tr>
<tr class="even">
<td>89</td>
<td>764796</td>
<td>2020-01-07 00:00:00</td>
</tr>
<tr class="odd">
<td>127</td>
<td>17ccc5</td>
<td>2020-01-22 00:00:00</td>
</tr>
<tr class="even">
<td>81</td>
<td>b0b666</td>
<td>2020-03-01 00:00:00</td>
</tr>
<tr class="odd">
<td>260</td>
<td>a4f236</td>
<td>2020-01-08 00:00:00</td>
</tr>
<tr class="even">
<td>203</td>
<td>d1182f</td>
<td>2020-04-18 00:00:00</td>
</tr>
<tr class="odd">
<td>23</td>
<td>12dbc8</td>
<td>2020-01-18 00:00:00</td>
</tr>
<tr class="even">
<td>375</td>
<td>f61d69</td>
<td>2020-01-03 00:00:00</td>
</tr>
</tbody>
</table>
</section>
<section id="events" class="level3">
<h3 class="anchored" data-anchor-id="events">Events</h3>
<p>Customer visits are logged in this <code>events</code> table at a <code>cookie_id</code> level and the <code>event_type</code> and <code>page_id</code> values can be used to join onto relevant satellite tables to obtain further information about each event.</p>
<p>The sequence_number is used to order the events within each visit.</p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 20%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>visit_id</th>
<th>cookie_id</th>
<th>page_id</th>
<th>event_type</th>
<th>sequence_number</th>
<th>event_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>719fd3</td>
<td>3d83d3</td>
<td>5</td>
<td>1</td>
<td>4</td>
<td>2020-03-02 00:29:09.975502</td>
</tr>
<tr class="even">
<td>fb1eb1</td>
<td>c5ff25</td>
<td>5</td>
<td>2</td>
<td>8</td>
<td>2020-01-22 07:59:16.761931</td>
</tr>
<tr class="odd">
<td>23fe81</td>
<td>1e8c2d</td>
<td>10</td>
<td>1</td>
<td>9</td>
<td>2020-03-21 13:14:11.745667</td>
</tr>
<tr class="even">
<td>ad91aa</td>
<td>648115</td>
<td>6</td>
<td>1</td>
<td>3</td>
<td>2020-04-27 16:28:09.824606</td>
</tr>
<tr class="odd">
<td>5576d7</td>
<td>ac418c</td>
<td>6</td>
<td>1</td>
<td>4</td>
<td>2020-01-18 04:55:10.149236</td>
</tr>
<tr class="even">
<td>48308b</td>
<td>c686c1</td>
<td>8</td>
<td>1</td>
<td>5</td>
<td>2020-01-29 06:10:38.702163</td>
</tr>
<tr class="odd">
<td>46b17d</td>
<td>78f9b3</td>
<td>7</td>
<td>1</td>
<td>12</td>
<td>2020-02-16 09:45:31.926407</td>
</tr>
<tr class="even">
<td>9fd196</td>
<td>ccf057</td>
<td>4</td>
<td>1</td>
<td>5</td>
<td>2020-02-14 08:29:12.922164</td>
</tr>
<tr class="odd">
<td>edf853</td>
<td>f85454</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2020-02-22 12:59:07.652207</td>
</tr>
<tr class="even">
<td>3c6716</td>
<td>02e74f</td>
<td>3</td>
<td>2</td>
<td>5</td>
<td>2020-01-31 17:56:20.777383</td>
</tr>
</tbody>
</table>
</section>
<section id="event-identifier" class="level3">
<h3 class="anchored" data-anchor-id="event-identifier">Event Identifier</h3>
<p>The <code>event_identifier</code> table shows the types of events which are captured by Clique Bait’s digital data systems.</p>
<table class="table">
<thead>
<tr class="header">
<th>event_type</th>
<th>event_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Page View</td>
</tr>
<tr class="even">
<td>2</td>
<td>Add to Cart</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Purchase</td>
</tr>
<tr class="even">
<td>4</td>
<td>Ad Impression</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Ad Click</td>
</tr>
</tbody>
</table>
</section>
<section id="campaign-identifier" class="level3">
<h3 class="anchored" data-anchor-id="campaign-identifier">Campaign Identifier</h3>
<p>This table shows information for the 3 campaigns that Clique Bait has ran on their website so far in 2020.</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 35%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>campaign_id</th>
<th>products</th>
<th>campaign_name</th>
<th>start_date</th>
<th>end_date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1-3</td>
<td>BOGOF - Fishing For Compliments</td>
<td>2020-01-01 00:00:00</td>
<td>2020-01-14 00:00:00</td>
</tr>
<tr class="even">
<td>2</td>
<td>4-5</td>
<td>25% Off - Living The Lux Life</td>
<td>2020-01-15 00:00:00</td>
<td>2020-01-28 00:00:00</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6-8</td>
<td>Half Off - Treat Your Shellf(ish)</td>
<td>2020-02-01 00:00:00</td>
<td>2020-03-31 00:00:00</td>
</tr>
</tbody>
</table>
</section>
<section id="page-hierarchy" class="level3">
<h3 class="anchored" data-anchor-id="page-hierarchy">Page Hierarchy</h3>
<p>This table lists all of the pages on the Clique Bait website which are tagged and have data passing through from user interaction events.</p>
<table class="table">
<thead>
<tr class="header">
<th>page_id</th>
<th>page_name</th>
<th>product_category</th>
<th>product_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Home Page</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>2</td>
<td>All Products</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Salmon</td>
<td>Fish</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>Kingfish</td>
<td>Fish</td>
<td>2</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Tuna</td>
<td>Fish</td>
<td>3</td>
</tr>
<tr class="even">
<td>6</td>
<td>Russian Caviar</td>
<td>Luxury</td>
<td>4</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Black Truffle</td>
<td>Luxury</td>
<td>5</td>
</tr>
<tr class="even">
<td>8</td>
<td>Abalone</td>
<td>Shellfish</td>
<td>6</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Lobster</td>
<td>Shellfish</td>
<td>7</td>
</tr>
<tr class="even">
<td>10</td>
<td>Crab</td>
<td>Shellfish</td>
<td>8</td>
</tr>
<tr class="odd">
<td>11</td>
<td>Oyster</td>
<td>Shellfish</td>
<td>9</td>
</tr>
<tr class="even">
<td>12</td>
<td>Checkout</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>13</td>
<td>Confirmation</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="interactive-sql-instance" class="level2">
<h2 class="anchored" data-anchor-id="interactive-sql-instance">Interactive SQL Instance</h2>
<p>The Dataset for this case study can be accessed from <a href="https://www.db-fiddle.com/f/jmnwogTsUE8hGqkZv9H7E8/17">here</a>. I will be using MySQL to solve this case study. In order to solve yourself this case study, simply go to the above link and choose MySQL Dialect (version &gt; 8, if using MySQL version higher than 8 locally), copy &amp; paste the Database schema into MySQL.</p>
<p>Here is the snapshot of it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/9bc5b2a6-1-5.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">5.png</figcaption>
</figure>
</div>
<hr>
</section>
<section id="case-study-questions" class="level2">
<h2 class="anchored" data-anchor-id="case-study-questions">Case Study Questions</h2>
<section id="enterprise-relationship-diagram" class="level3">
<h3 class="anchored" data-anchor-id="enterprise-relationship-diagram">1. Enterprise Relationship Diagram</h3>
<p>Using the following DDL schema details to create an ERD for all the Clique Bait datasets. <a href="https://dbdiagram.io/">Click_Here</a> to access the DB Diagram tool to create the ERD.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/a2fdb438-1-3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">3.png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/b99a3f93-1-4.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">4.png</figcaption>
</figure>
</div>
</section>
<section id="digital-analysis" class="level3">
<h3 class="anchored" data-anchor-id="digital-analysis">2. Digital Analysis</h3>
<p>Using the available datasets - answer the following questions using a single query for each one:</p>
<ol type="1">
<li>How many users are there?</li>
<li>How many cookies does each user have on average?</li>
<li>What is the unique number of visits by all users per month?</li>
<li>What is the number of events for each event type?</li>
<li>What is the percentage of visits which have a purchase event?</li>
<li>What is the percentage of visits which view the checkout page but do not have a purchase event?</li>
<li>What are the top 3 pages by number of views?</li>
<li>What is the number of views and cart adds for each product category?</li>
<li>What are the top 3 products by purchases?</li>
</ol>
</section>
<section id="product-funnel-analysis" class="level3">
<h3 class="anchored" data-anchor-id="product-funnel-analysis">3. Product Funnel Analysis</h3>
<p>Using a single SQL query - create a new output table which has the following details:</p>
<ul>
<li>How many times was each product viewed?</li>
<li>How many times was each product added to cart?</li>
<li>How many times was each product added to a cart but not purchased (abandoned)?</li>
<li>How many times was each product purchased?</li>
</ul>
<p>Additionally, create another table which further aggregates the data for the above points but this time for each product category instead of individual products.</p>
<p>Use your 2 new output tables - answer the following questions:</p>
<ol type="1">
<li>Which product had the most views, cart adds and purchases?</li>
<li>Which product was most likely to be abandoned?</li>
<li>Which product had the highest view to purchase percentage?</li>
<li>What is the average conversion rate from view to cart add?</li>
<li>What is the average conversion rate from cart add to purchase?</li>
</ol>
</section>
<section id="campaigns-analysis" class="level3">
<h3 class="anchored" data-anchor-id="campaigns-analysis">4. Campaigns Analysis</h3>
<p>Generate a table that has 1 single row for every unique <code>visit_id</code> record and has the following columns:</p>
<ul>
<li><code>user_id</code></li>
<li><code>visit_id</code></li>
<li><code>visit_start_time</code>: the earliest <code>event_time</code> for each visit</li>
<li><code>page_views</code>: count of page views for each visit</li>
<li><code>cart_adds</code>: count of product cart add events for each visit</li>
<li><code>purchase</code>: 1/0 flag if a purchase event exists for each visit</li>
<li><code>campaign_name</code>: map the visit to a campaign if the <code>visit_start_time</code> falls between the <code>start_date</code> and <code>end_date</code></li>
<li><code>impression</code>: count of ad impressions for each visit</li>
<li><code>click</code>: count of ad clicks for each visit</li>
<li><strong>(Optional column)</strong> <code>cart_products</code>: a comma separated text value with products added to the cart sorted by the order they were added to the cart (hint: use the <code>sequence_number</code>)</li>
</ul>
<p>Use the subsequent dataset to generate at least 5 insights for the Clique Bait team - bonus: prepare a single A4 infographic that the team can use for their management reporting sessions, be sure to emphasise the most important points from your findings.</p>
<p>Some ideas you might want to investigate further include:</p>
<ul>
<li>Identifying users who have received impressions during each campaign period and comparing each metric with other users who did not have an impression event</li>
<li>Does clicking on an impression lead to higher purchase rates?</li>
<li>What is the uplift in purchase rate when comparing users who click on a campaign impression versus users who do not receive an impression? What if we compare them with users who just an impression but do not click?</li>
<li>What metrics can you use to quantify the success or failure of each campaign compared to each other?</li>
</ul>
</section>
</section>
<section id="lets-start-solving-them." class="level2">
<h2 class="anchored" data-anchor-id="lets-start-solving-them.">Let’s start solving them.</h2>
<section id="digital-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="digital-analysis-1">2. Digital Analysis</h3>
<p>Using the available datasets - answer the following questions using a single query for each one:</p>
<ul>
<li><strong>1. How many users are there?</strong></li>
</ul>
<p><strong><code>Explanation</code></strong>: This SQL query provides the count of unique users in the ‘users’ dataset.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/99a50045-1-6.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">6.png</figcaption>
</figure>
</div>
<ul>
<li><strong>2. How many cookies does each user have on average?</strong></li>
</ul>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query calculates the average number of cookies per user in the dataset:</em></strong></p>
<p><strong>1) Calculating Cookie Count per User:</strong></p>
<pre><code>WITH cookie AS (
SELECT user_id, COUNT(cookie_id) AS cookie_count FROM users GROUP BY user_id)</code></pre>
<p>Creates a Common Table Expression (CTE) named ‘cookie’ that counts the number of cookies for each user in the ‘users’ table using the COUNT function and grouping by ‘user_id’.</p>
<p><strong>2) Calculating Average Cookie per User:</strong></p>
<pre><code>SELECT ROUND(AVG(cookie_count), 0) AS average_cookie_per_user FROM cookie;</code></pre>
<p>Calculates the average number of cookies per user by taking the average of the ‘cookie_count’ column from the ‘cookie’ CTE. The result is rounded to zero decimal places for clarity.</p>
<p><strong><code>Final Concise Explanation</code></strong>: This SQL query provides the average number of cookies per user in the dataset by counting the cookies for each user and then calculating the overall average.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/04c9b9c2-1-7.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">7.png</figcaption>
</figure>
</div>
<ul>
<li><strong>3. What is the unique number of visits by all users per month?</strong></li>
</ul>
<p><strong><code>Explanation</code></strong>:</p>
<p>This SQL query provides the unique number of visits by all users per month in the ‘events’ dataset by extracting the month from the event timestamp and counting the distinct visit IDs for each month.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/1d235c27-1-8.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">8.png</figcaption>
</figure>
</div>
<ul>
<li><strong>4. What is the number of events for each event type?</strong></li>
</ul>
<p><strong><code>Explantion</code></strong>: This SQL query provides the number of events for each event type by joining the ‘events’ table with the ‘event_identifier’ table, counting the events for each type, and presenting the results ordered by the count of events in descending order.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/0bdf40e7-1-Case_study_6_8.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Case_study_6_8.png</figcaption>
</figure>
</div>
<ul>
<li><strong>5. What is the percentage of visits which have a purchase event?</strong></li>
</ul>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query calculates the percentage of visits that have a purchase event. Let’s break it down step by step:</em></strong></p>
<p><strong>1) Joining Events with Event Identifiers:</strong></p>
<pre><code>FROM events AS E
JOIN event_identifier AS EI ON E.event_type = EI.event_type</code></pre>
<p>Joins the ‘events’ table (aliased as E) with the ‘event_identifier’ table (aliased as EI) based on the common column ‘event_type’. This allows us to associate event types with their corresponding names.</p>
<p><strong>2) Counting Visits with Purchase Events:</strong></p>
<pre><code>COUNT(DISTINCT E.visit_id)</code></pre>
<p>Counts the distinct visit IDs from the ‘events’ table (aliased as E) where the event type is associated with a purchase event. This gives the number of visits with at least one purchase event.</p>
<p><strong>3) Calculating the Percentage:</strong></p>
<pre><code>ROUND(100.0 * COUNT(DISTINCT E.visit_id) / (SELECT COUNT(DISTINCT visit_id) FROM events),2)</code></pre>
<p>Calculates the percentage by dividing the count of distinct visits with purchase events by the total count of distinct visits from the ‘events’ table. The result is multiplied by 100 and rounded to two decimal places.</p>
<p><strong>4) Filtering for Purchase Events:</strong></p>
<pre><code>WHERE EI.event_name = 'Purchase'</code></pre>
<p>Filters the results to consider only events with the name ‘Purchase’. This ensures that only visits with purchase events are included in the calculation.</p>
<p><strong><code>Final Concise Explanation</code></strong>: The SQL query calculates the percentage of visits that have a purchase event by counting the distinct visits with purchase events, dividing it by the total count of distinct visits, multiplying by 100, and rounding to two decimal places. The query only considers events with the name ‘Purchase’ for the calculation.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/cc1ea003-1-10.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">10.png</figcaption>
</figure>
</div>
<ul>
<li><p><strong>6. What is the percentage of visits which view the checkout page but do not have a purchase event?</strong></p></li>
<li><p><strong>7. What are the top 3 pages by number of views?</strong></p></li>
</ul>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query identifies the top 3 pages by the number of views. Let’s break it down step by step:</em></strong></p>
<p><strong>1) Filtering Relevant Events:</strong></p>
<pre><code>WHERE event_type = '1'</code></pre>
<p>Filters events to consider only those with the event type equal to ‘1’. This assumes that event type ‘1’ represents page views.</p>
<p><strong>2) Grouping and Counting Views per Page:</strong></p>
<pre><code>WITH top_3_pages AS
(SELECT page_id, COUNT(DISTINCT visit_id) AS number_of_views
 FROM events
 WHERE event_type = '1'
 GROUP BY page_id
 ORDER BY number_of_views DESC
 LIMIT 3)</code></pre>
<p>Creates a Common Table Expression (CTE) named ‘top_3_pages’ that groups events by page_id, counts the distinct visit IDs for each page, orders the results by the number of views in descending order, and limits the output to the top 3 pages.</p>
<p><strong>3) Joining with Page Hierarchy:</strong></p>
<pre><code>SELECT page_name, number_of_views
FROM top_3_pages
JOIN page_hierarchy ON top_3_pages.page_id = page_hierarchy.page_id;</code></pre>
<p>Joins the ‘top_3_pages’ CTE with the ‘page_hierarchy’ table based on the common column ‘page_id’ to get the corresponding page names for the top 3 pages.</p>
<p><strong><code>Final Concise Explanation</code></strong>: This SQL query identifies the top 3 pages by the number of views by first filtering relevant events (assumed to be page views), grouping and counting views per page, and then joining with the page hierarchy to obtain the page names associated with the top 3 pages.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/738e0891-1-11.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">11.png</figcaption>
</figure>
</div>
<ul>
<li><strong>8. What is the number of views and cart adds for each product category?</strong></li>
</ul>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query calculates the number of views and cart adds for each product category.</em></strong></p>
<p><strong>1) Joining Events with Page Hierarchy:</strong></p>
<pre><code>FROM events as E JOIN page_hierarchy AS PH ON E.page_id = PH.page_id</code></pre>
<p>Joins the ‘events’ table (aliased as E) with the ‘page_hierarchy’ table (aliased as PH) based on the common column ‘page_id’.</p>
<p><strong>2) Filtering Relevant Rows:</strong></p>
<pre><code>WHERE PH.product_category IS NOT NULL</code></pre>
<p>Filters the rows to include only those where the product category is not null. This ensures that only events related to products are considered.</p>
<p><strong>3) Counting Views and Cart Adds per Product Category:</strong></p>
<pre><code>SUM(CASE WHEN E.event_type = '1' THEN 1 ELSE 0 END) AS number_of_views,
SUM(CASE WHEN E.event_type = '2' THEN 1 ELSE 0 END) AS number_of_cart_adds</code></pre>
<p>Uses conditional aggregation to count the number of views and cart adds for each product category. The CASE WHEN statement is used to determine if the event type is a view (event_type = ‘1’) or a cart add (event_type = ‘2’).</p>
<p><strong>4) Grouping by Product Category and Ordering:</strong></p>
<pre><code>GROUP BY PH.product_category
ORDER BY PH.product_category;</code></pre>
<p>Groups the results by product category and orders them alphabetically by product category.</p>
<p><strong><code>Final Concise Explanation</code></strong>: This SQL query calculates the number of views and cart adds for each product category by joining the ‘events’ table with the ‘page_hierarchy’ table, filtering relevant rows, and using conditional aggregation to count the events based on their types. The results are then grouped by product category and ordered alphabetically.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/16350d19-1-12.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">12.png</figcaption>
</figure>
</div>
<ul>
<li><strong>9. What are the top 3 products by purchases?</strong></li>
</ul>
</section>
<section id="product-funnel-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="product-funnel-analysis-1">3. Product Funnel Analysis</h3>
<p>Using a single SQL query - create a new output table which has the following details:</p>
<ul>
<li>How many times was each product viewed?</li>
<li>How many times was each product added to cart?</li>
<li>How many times was each product added to a cart but not purchased (abandoned)?</li>
<li>How many times was each product purchased?</li>
</ul>
<p>Additionally, create another table which further aggregates the data for the above points but this time for each product category instead of individual products.</p>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query is the first part of a product funnel analysis. It creates a temporary table (view_add_to_cart_cte) with details about how many times each product was viewed and added to the cart.</em></strong></p>
<p><strong>1) Creating a Temporary Table:</strong></p>
<pre><code>CREATE TEMPORARY TABLE view_add_to_cart_cte AS</code></pre>
<p>Creates a temporary table named <code>view_add_to_cart_cte</code> to store the results.</p>
<p><strong>2) Selecting Relevant Columns and Calculating Counts:</strong></p>
<pre><code>SELECT 
PH.product_id, 
PH.page_name AS product_name, 
PH.product_category,
SUM(CASE WHEN EI.event_name = 'Page View' THEN 1 ELSE 0 END) AS view_counts,
SUM(CASE WHEN EI.event_name = 'Add to Cart' THEN 1 ELSE 0 END) AS add_to_cart_counts</code></pre>
<p>Selects the product_id, product_name, product_category, and calculates the counts of page views and add-to-cart events using conditional aggregation.</p>
<p><strong>3) Joining Tables and Filtering:</strong></p>
<pre><code>FROM 
events AS E 
JOIN event_identifier AS EI ON E.event_type = EI.event_type
JOIN page_hierarchy AS PH ON E.page_id = PH.page_id 
WHERE 
    PH.product_category IS NOT NULL</code></pre>
<p>Joins the ‘events’ table with ‘event_identifier’ and ‘page_hierarchy’ tables based on common columns. It filters only rows where the product category is not null, indicating relevant product-related events.</p>
<p><strong>4) Grouping by Product Information:</strong></p>
<pre><code>GROUP BY 
PH.product_id, PH.page_name, PH.product_category;</code></pre>
<p>Groups the results by product_id, page_name, and product_category to obtain aggregated counts for each product.</p>
<p><strong><code>Final Concise Explanation</code></strong>: This part of the query creates a temporary table (<code>view_add_to_cart_cte</code>) with details about how many times each product was viewed and added to the cart. It calculates counts for page views and add-to-cart events, filtering for relevant product-related events. The results are grouped by product information.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/476091fb-1-13.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">13.png</figcaption>
</figure>
</div>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query is the second part of a product funnel analysis. It creates a temporary table (products_abandoned_cte) with details about how many times each product was added to the cart but not purchased (abandoned).</em></strong></p>
<p><strong>1) Creating a Temporary Table:</strong></p>
<pre><code>CREATE TEMPORARY TABLE products_abandoned_cte AS</code></pre>
<p>Creates a temporary table named <code>products_abandoned_cte</code> to store the results.</p>
<p><strong>2) Selecting Relevant Columns and Calculating Counts:</strong></p>
<pre><code>SELECT 
PH.product_id, 
PH.page_name AS product_name,
PH.product_category, 
COUNT(*) AS abandoned</code></pre>
<p>Selects the product_id, product_name, product_category, and calculates the count of abandoned events (add-to-cart events not leading to a purchase).</p>
<p><strong>3) Joining Tables and Filtering:</strong></p>
<pre><code>FROM 
events AS E 
JOIN event_identifier AS EI ON E.event_type = EI.event_type 
JOIN page_hierarchy AS PH ON E.page_id = PH.page_id 
WHERE 
    EI.event_name = 'Add to Cart'
    AND E.visit_id NOT IN (
        SELECT E.visit_id 
        FROM events AS E
        JOIN event_identifier AS EI ON E.event_type = EI.event_type 
    WHERE EI.event_name = 'Purchase')</code></pre>
<p>Joins the ‘events’ table with ‘event_identifier’ and ‘page_hierarchy’ tables based on common columns. It filters only rows where the event is an ‘Add to Cart’ event and the visit_id is not associated with a ‘Purchase’ event.</p>
<p><strong>4) Grouping by Product Information:</strong></p>
<pre><code>GROUP BY 
PH.product_id, PH.page_name, PH.product_category;</code></pre>
<p>Groups the results by product_id, page_name, and product_category to obtain aggregated counts of abandoned events for each product.</p>
<p><strong><code>Final Concise Explanation</code></strong>: This part of the query creates a temporary table (products_abandoned_cte) with details about how many times each product was added to the cart but not purchased (abandoned). It calculates counts for abandoned events, filtering for add-to-cart events not associated with a purchase. The results are grouped by product information.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/f118a9ac-1-14.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">14.png</figcaption>
</figure>
</div>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query is the third part of a product funnel analysis. It creates a temporary table (products_purchased_cte) with details about how many times each product was purchased.</em></strong></p>
<p><strong>1) Creating a Temporary Table:</strong></p>
<pre><code>CREATE TEMPORARY TABLE products_purchased_cte AS</code></pre>
<p>Creates a temporary table named <code>products_purchased_cte</code> to store the results.</p>
<p><strong>2) Selecting Relevant Columns and Calculating Counts:</strong></p>
<pre><code>SELECT 
PH.product_id, 
PH.page_name AS product_name,
PH.product_category, 
COUNT(*) AS purchased</code></pre>
<p>Selects the product_id, product_name, product_category, and calculates the count of purchased events (add-to-cart events leading to a purchase).</p>
<p><strong>3) Joining Tables and Filtering:</strong></p>
<pre><code>FROM 
events AS E 
JOIN event_identifier AS EI ON E.event_type = EI.event_type 
JOIN page_hierarchy AS PH ON E.page_id = PH.page_id 
WHERE 
    EI.event_name = 'Add to Cart'
    AND E.visit_id IN (
        SELECT E.visit_id 
        FROM events AS E
        JOIN event_identifier AS EI ON E.event_type = EI.event_type 
        WHERE EI.event_name = 'Purchase')</code></pre>
<p>Joins the ‘events’ table with ‘event_identifier’ and ‘page_hierarchy’ tables based on common columns. It filters only rows where the event is an ‘Add to Cart’ event and the visit_id is associated with a ‘Purchase’ event.</p>
<p><strong>4) Grouping by Product Information:</strong></p>
<pre><code>GROUP BY 
PH.product_id, PH.page_name, PH.product_category;</code></pre>
<p>Groups the results by product_id, page_name, and product_category to obtain aggregated counts of abandoned events for each product.</p>
<p><strong><code>Final Concise Explanation</code></strong>: This part of the query creates a temporary table (products_purchased_cte) with details about how many times each product was purchased. It calculates counts for purchased events, filtering for add-to-cart events associated with a purchase. The results are grouped by product information.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/1ff0113b-1-15.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">15.png</figcaption>
</figure>
</div>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query combines the results from the previous temporary tables (<code>view_add_to_cart_cte</code>, <code>products_abandoned_cte</code>, <code>products_purchased_cte</code>) into a final temporary table (<code>product_information</code>). It then selects and displays the contents of the final temporary table.</em></strong></p>
<p><strong>1) Creating a Temporary Table:</strong></p>
<pre><code>CREATE TEMPORARY TABLE product_information  AS</code></pre>
<p>Creates a temporary table named <code>product_information</code> to store the results.</p>
<p><strong>2) Selecting and Joining Tables:</strong></p>
<pre><code>SELECT 
VATC.*,
AB.abandoned, 
PP.purchased
FROM 
    view_add_to_cart_cte AS VATC
    JOIN products_abandoned_cte AS AB ON VATC.product_id = AB.product_id
    JOIN products_purchased_cte AS PP ON VATC.product_id = PP.product_id;</code></pre>
<ul>
<li><p>Selects columns from the <code>view_add_to_cart_cte</code> and joins it with the <code>products_abandoned_cte</code> and <code>products_purchased_cte</code> tables based on the common column <code>product_id</code>.</p></li>
<li><p>Combines information about the number of views, cart additions, abandoned events, and purchased events for each product.</p></li>
</ul>
<p><strong>3) Selecting from the Temporary Table:</strong></p>
<pre><code>SELECT * FROM product_information
ORDER BY product_id;</code></pre>
<ul>
<li>Selects and displays all columns from the final temporary table (<code>product_information</code>).</li>
<li>Orders the results by <code>product_id</code> for better readability.</li>
</ul>
<p><strong>4) Grouping by Product Information:</strong></p>
<pre><code>GROUP BY 
PH.product_id, PH.page_name, PH.product_category;</code></pre>
<p>Groups the results by product_id, page_name, and product_category to obtain aggregated counts of abandoned events for each product.</p>
<p><strong>5) Dropping Temporary Tables:</strong></p>
<pre><code>DROP TEMPORARY TABLE IF EXISTS view_add_to_cart_cte, products_abandoned_cte, products_purchased_cte;</code></pre>
<p>This SQL query drops the temporary tables (view_add_to_cart_cte, products_abandoned_cte, products_purchased_cte) when they are no longer needed.</p>
<p><strong><code>Final Concise Explanation</code></strong>: This query combines the results from the previous temporary tables (<code>view_add_to_cart_cte</code>, <code>products_abandoned_cte</code>, <code>products_purchased_cte</code>) into a final temporary table named <code>product_information</code>. It includes information about the number of views, cart additions, abandoned events, and purchased events for each product. The final results are then selected and displayed from the temporary table, ordered by <code>product_id</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/9c186723-1-16.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">16.png</figcaption>
</figure>
</div>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query creates a temporary table (<code>category_view_add_to_cart_cte</code>) to aggregate data for each product category instead of individual products.</em></strong></p>
<p><strong>1) Aggregating Data by Product Category:</strong></p>
<pre><code>-- Use temporary table instead of INTO for CTEs
CREATE TEMPORARY TABLE category_view_add_to_cart_cte AS
SELECT 
    PH.product_category,
    SUM(CASE WHEN EI.event_name = 'Page View' THEN 1 ELSE 0 END) AS view_counts,
    SUM(CASE WHEN EI.event_name = 'Add to Cart' THEN 1 ELSE 0 END) AS add_to_cart_counts
FROM 
    events AS E 
    JOIN event_identifier AS EI ON E.event_type = EI.event_type
    JOIN page_hierarchy AS PH ON E.page_id = PH.page_id 
WHERE 
    PH.product_category IS NOT NULL
GROUP BY 
    PH.product_category;</code></pre>
<p><strong><code>Step-by-Step Explanation:</code></strong></p>
<p><strong>1) Temporary Table Creation:</strong></p>
<pre><code>- CREATE TEMPORARY TABLE category_view_add_to_cart_cte: Initiates the creation of a temporary table named category_view_add_to_cart_cte.</code></pre>
<p><strong>2) Data Selection and Aggregation:</strong></p>
<pre><code>- SELECT PH.product_category: Selects the product_category column from the page_hierarchy table.
- SUM(CASE WHEN EI.event_name = 'Page View' THEN 1 ELSE 0 END) AS view_counts: Calculates the total number of page views (view_counts) for each product category.
- SUM(CASE WHEN EI.event_name = 'Add to Cart' THEN 1 ELSE 0 END) AS add_to_cart_counts: Calculates the total number of "Add to Cart" events (add_to_cart_counts) for each product category.</code></pre>
<p><strong>3) Table Joins:</strong></p>
<pre><code>- FROM events AS E: Specifies the events table with the alias E.
- JOIN event_identifier AS EI ON E.event_type = EI.event_type: Joins the event_identifier table using the event_type.
- JOIN page_hierarchy AS PH ON E.page_id = PH.page_id: Joins the page_hierarchy table using the page_id.</code></pre>
<p><strong>4) Filtering by Product Category:</strong></p>
<pre><code>- WHERE PH.product_category IS NOT NULL: Filters out rows where the product category is null, focusing on valid product categories.</code></pre>
<p><strong>5) Grouping by Product Category:</strong></p>
<pre><code>- GROUP BY PH.product_category: Groups the results by product category, ensuring that each row represents a unique product category.</code></pre>
<p><strong><code>Final Concise Explanation</code></strong>: This query creates a temporary table (<code>category_view_add_to_cart_cte</code>) that summarizes data for each product category. It calculates the total number of page views and “Add to Cart” events for each product category, providing a higher-level analysis of user interactions within different product categories.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/8876cee6-1-17.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">17.png</figcaption>
</figure>
</div>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query creates a temporary table (<code>category_products_abandoned_cte</code>) that counts the number of abandoned products for each product category.</em></strong></p>
<p><strong>1) Creating Table for Abandoned Products by Category:</strong></p>
<pre><code>-- Use temporary table instead of INTO for CTEs
CREATE TEMPORARY TABLE category_products_abandoned_cte AS
SELECT 
    PH.product_category, 
    COUNT(*) AS abandoned
FROM 
    events AS E 
    JOIN event_identifier AS EI ON E.event_type = EI.event_type 
    JOIN page_hierarchy AS PH ON E.page_id = PH.page_id 
WHERE 
    EI.event_name = 'Add to Cart'
    AND E.visit_id NOT IN (
        SELECT E.visit_id 
        FROM events AS E
        JOIN event_identifier AS EI ON E.event_type = EI.event_type 
        WHERE EI.event_name = 'Purchase'
    ) 
GROUP BY 
    PH.product_category;</code></pre>
<p><strong><code>Step-by-Step Explanation:</code></strong></p>
<p><strong>1) Temporary Table Creation:</strong></p>
<pre><code>- CREATE TEMPORARY TABLE category_products_abandoned_cte: Initiates the creation of a temporary table named category_products_abandoned_cte.</code></pre>
<p><strong>2) Data Selection and Aggregation:</strong></p>
<pre><code>- SELECT PH.product_category: Selects the product_category column from the page_hierarchy table.
- COUNT(*) AS abandoned: Counts the number of rows (abandoned products) for each product category.</code></pre>
<p><strong>3) Table Joins:</strong></p>
<pre><code>- FROM events AS E: Specifies the events table with the alias E.
- JOIN event_identifier AS EI ON E.event_type = EI.event_type: Joins the event_identifier table using the event_type.
- JOIN page_hierarchy AS PH ON E.page_id = PH.page_id: Joins the page_hierarchy table using the page_id.</code></pre>
<p><strong>4) Filtering by Event Type and Excluding Purchased Visits:</strong></p>
<pre><code>- WHERE EI.event_name = 'Add to Cart': Filters rows where the event is an "Add to Cart" event.
- AND E.visit_id NOT IN (...): Excludes visits where a purchase event has occurred, preventing counting products that were eventually purchased.</code></pre>
<p><strong>5) Grouping by Product Category:</strong></p>
<pre><code>- GROUP BY PH.product_category: Groups the results by product category, ensuring that each row represents a unique product category.</code></pre>
<p><strong><code>Final Concise Explanation</code></strong>: This query creates a temporary table (<code>category_products_abandoned_cte</code>) that counts the number of abandoned products for each product category. It focuses on “Add to Cart” events and excludes visits where a purchase event has occurred, providing insights into the abandonment behavior within different product categories.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/653ae9a8-1-18.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">18.png</figcaption>
</figure>
</div>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query creates a temporary table (<code>category_products_purchased_cte</code>) that counts the number of purchased products for each product category.</em></strong></p>
<p><strong>1) Creating Table for Purchased Products by Category:</strong></p>
<pre><code>-- Use temporary table instead of INTO for CTEs
CREATE TEMPORARY TABLE category_products_purchased_cte AS
SELECT 
    PH.product_category, 
    COUNT(*) AS purchased
FROM 
    events AS E 
    JOIN event_identifier AS EI ON E.event_type = EI.event_type 
    JOIN page_hierarchy AS PH ON E.page_id = PH.page_id 
WHERE 
    EI.event_name = 'Add to Cart'
    AND E.visit_id IN (
        SELECT E.visit_id 
        FROM events AS E
        JOIN event_identifier AS EI ON E.event_type = EI.event_type 
        WHERE EI.event_name = 'Purchase'
    ) 
GROUP BY 
    PH.product_category;</code></pre>
<p><strong><code>Step-by-Step Explanation:</code></strong></p>
<p><strong>1) Temporary Table Creation:</strong></p>
<pre><code>- CREATE TEMPORARY TABLE category_products_purchased_cte: Initiates the creation of a temporary table named category_products_purchased_cte.</code></pre>
<p><strong>2) Data Selection and Aggregation:</strong></p>
<pre><code>- SELECT PH.product_category: Selects the product_category column from the page_hierarchy table.
- COUNT(*) AS purchased: Counts the number of rows (purchased products) for each product category.</code></pre>
<p><strong>3) Table Joins:</strong></p>
<pre><code>- FROM events AS E: Specifies the events table with the alias E.
- JOIN event_identifier AS EI ON E.event_type = EI.event_type: Joins the event_identifier table using the event_type.
- JOIN page_hierarchy AS PH ON E.page_id = PH.page_id: Joins the page_hierarchy table using the page_id.</code></pre>
<p><strong>4) Filtering by Event Type and Including Purchased Visits:</strong></p>
<pre><code>- WHERE EI.event_name = 'Add to Cart': Filters rows where the event is an "Add to Cart" event.
- AND E.visit_id IN (...): Includes visits where a purchase event has occurred, ensuring that only products added to the cart and later purchased are counted.</code></pre>
<p><strong>5) Grouping by Product Category:</strong></p>
<pre><code>- GROUP BY PH.product_category: Groups the results by product category, ensuring that each row represents a unique product category.</code></pre>
<p><strong><code>Final Concise Explanation</code></strong>: This query creates a temporary table (<code>category_products_purchased_cte</code>) that counts the number of purchased products for each product category. It focuses on “Add to Cart” events and includes visits where a purchase event has occurred, providing insights into the products that were added to the cart and eventually purchased within different product categories.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/78ffc77c-1-19.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">19.png</figcaption>
</figure>
</div>
<p><strong><code>Explanation</code></strong>:</p>
<p><strong><em>This SQL query creates a temporary table (<code>category_product_information</code>) that aggregates information about product categories, including the number of views, additions to cart, abandoned products, and purchased products.</em></strong></p>
<p><strong>1) Creating Table for Aggregated Category Product Information:</strong></p>
<pre><code>-- Use temporary table instead of INTO for the final result
CREATE TEMPORARY TABLE category_product_information AS
SELECT 
    VATC.*,
    AB.abandoned, 
    PP.purchased
FROM 
    category_view_add_to_cart_cte AS VATC
    JOIN category_products_abandoned_cte AS AB ON VATC.product_category = AB.product_category
    JOIN category_products_purchased_cte AS PP ON VATC.product_category = PP.product_category;

-- Select from the temporary table
SELECT * FROM category_product_information
ORDER BY product_category;

-- Drop the temporary tables when done
DROP TEMPORARY TABLE IF EXISTS category_view_add_to_cart_cte, category_products_abandoned_cte, 
category_products_purchased_cte;</code></pre>
<p><strong><code>Step-by-Step Explanation:</code></strong></p>
<p><strong>1) Temporary Table Creation:</strong></p>
<pre><code>- CREATE TEMPORARY TABLE category_product_information: Initiates the creation of a temporary table named category_product_information.</code></pre>
<p><strong>2) Data Selection and Joining Tables:</strong></p>
<pre><code>- SELECT PH.product_category: Selects the product_category column from the page_hierarchy table.
- COUNT(*) AS purchased: Counts the number of rows (purchased products) for each product category.</code></pre>
<p><strong>3) Table Joins:</strong></p>
<pre><code>- FROM category_view_add_to_cart_cte AS VATC: Specifies the temporary table category_view_add_to_cart_cte with the alias VATC.
- JOIN category_products_abandoned_cte AS AB ON VATC.product_category = AB.product_category: Joins the temporary table with the abandoned products table based on the product_category.
- JOIN category_products_purchased_cte AS PP ON VATC.product_category = PP.product_category: Joins the temporary table with the purchased products table based on the product_category.</code></pre>
<p><strong>4) Final Result:</strong></p>
<pre><code>- The resulting temporary table (category_product_information) contains aggregated information for each product category, including the number of views, additions to cart, abandoned products, and purchased products.</code></pre>
<p><strong>5) Selection from Temporary Table:</strong></p>
<pre><code>- SELECT * FROM category_product_information ORDER BY product_category;: Retrieves all columns from the temporary table, ordering the results by product_category.</code></pre>
<p><strong>6) Temporary Table Cleanup:</strong></p>
<pre><code>- DROP TEMPORARY TABLE IF EXISTS category_view_add_to_cart_cte, category_products_abandoned_cte, category_products_purchased_cte;: Drops the temporary tables used in the process.</code></pre>
<p><strong><code>Final Concise Explanation</code></strong>: This query creates a temporary table (category_product_information) that aggregates information about product categories, including the number of views, additions to cart, abandoned products, and purchased products. The temporary table is then selected, providing a summary of product category data, and the temporary tables are dropped when the process is completed.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/867ffde7-1-20.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">20.png</figcaption>
</figure>
</div>
<p>Use your 2 new output tables - answer the following questions:</p>
<ul>
<li><strong>1. Which product had the most views, cart adds and purchases?</strong></li>
</ul>
<p><strong>Part 1</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/48db7eeb-1-21.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">21.png</figcaption>
</figure>
</div>
<p><strong>Part 2</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/8cf0ded1-1-22.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">22.png</figcaption>
</figure>
</div>
<p><strong>Part 3</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/1b513f74-1-23.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">23.png</figcaption>
</figure>
</div>
<ul>
<li><strong>2. Which product was most likely to be abandoned?</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/715d35ad-1-24.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">24.png</figcaption>
</figure>
</div>
<ul>
<li><strong>3. Which product had the highest view to purchase percentage?</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/a288fc2e-1-25.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">25.png</figcaption>
</figure>
</div>
<ul>
<li><strong>4. What is the average conversion rate from view to cart add?</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/2a4dd793-1-26.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">26.png</figcaption>
</figure>
</div>
<ul>
<li><strong>5. What is the average conversion rate from cart add to purchase?</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Case_Study_6-Clique_Bait_files/figure-html/d8ed4930-1-27.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">27.png</figcaption>
</figure>
</div>
</section>
<section id="campaigns-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="campaigns-analysis-1">4. Campaigns Analysis</h3>
<p>Generate a table that has 1 single row for every unique <code>visit_id</code> record and has the following columns:</p>
<ul>
<li><code>user_id</code></li>
<li><code>visit_id</code></li>
<li><code>visit_start_time</code>: the earliest <code>event_time</code> for each visit</li>
<li><code>page_views</code>: count of page views for each visit</li>
<li><code>cart_adds</code>: count of product cart add events for each visit</li>
<li><code>purchase</code>: 1/0 flag if a purchase event exists for each visit</li>
<li><code>campaign_name</code>: map the visit to a campaign if the <code>visit_start_time</code> falls between the <code>start_date</code> and <code>end_date</code></li>
<li><code>impression</code>: count of ad impressions for each visit</li>
<li><code>click</code>: count of ad clicks for each visit</li>
<li><strong>(Optional column)</strong> <code>cart_products</code>: a comma separated text value with products added to the cart sorted by the order they were added to the cart (hint: use the <code>sequence_number</code>)</li>
</ul>
<p>Use the subsequent dataset to generate at least 5 insights for the Clique Bait team - bonus: prepare a single A4 infographic that the team can use for their management reporting sessions, be sure to emphasise the most important points from your findings.</p>
<p>Some ideas you might want to investigate further include:</p>
<ul>
<li>Identifying users who have received impressions during each campaign period and comparing each metric with other users who did not have an impression event</li>
<li>Does clicking on an impression lead to higher purchase rates?</li>
<li>What is the uplift in purchase rate when comparing users who click on a campaign impression versus users who do not receive an impression? What if we compare them with users who just an impression but do not click?</li>
<li>What metrics can you use to quantify the success or failure of each campaign compared to each other?</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="Chirag1994/chiragsharma.github.io" data-repo-id="R_kgDOJfJZmg" data-category="General" data-category-id="DIC_kwDOJfJZms4CWR8c" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>